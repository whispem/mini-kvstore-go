version: '3.8'

services:
  volume-1:
    build: .
    container_name: mini-kvstore-go-vol-1
    ports:
      - "9001:9002"
    environment:
      - PORT=9002
      - VOLUME_ID=vol-1
      - DATA_DIR=/data
      - COMPACTION_THRESHOLD=5
      - COMPACTION_INTERVAL_SECS=60
    volumes:
      - vol1-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9002/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

  volume-2:
    build: .
    container_name: mini-kvstore-go-vol-2
    ports:
      - "9002:9002"
    environment:
      - PORT=9002
      - VOLUME_ID=vol-2
      - DATA_DIR=/data
      - COMPACTION_THRESHOLD=5
      - COMPACTION_INTERVAL_SECS=60
    volumes:
      - vol2-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9002/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

  volume-3:
    build: .
    container_name: mini-kvstore-go-vol-3
    ports:
      - "9003:9002"
    environment:
      - PORT=9002
      - VOLUME_ID=vol-3
      - DATA_DIR=/data
      - COMPACTION_THRESHOLD=5
      - COMPACTION_INTERVAL_SECS=60
    volumes:
      - vol3-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9002/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

volumes:
  vol1-data:
  vol2-data:
  vol3-data:
